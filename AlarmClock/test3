import sys
import os
print sys.path
sys.path.append('/usr/local/lib/python2.7/site-packages/')     #for allowing importing cv2 in my mac
from os import path
sys.path.append( path.dirname( path.dirname( path.abspath(__file__) ) ) )    #for allowing importing AlarmClock module
import argparse
import imutils
import cv2

from AlarmClock import Camera
from AlarmClock import Inference
from AlarmClock import ComputerVision
from AlarmClock import Sound


import sys
from PyQt4.QtGui import *
from PyQt4.QtCore import *

from PyQt4 import QtGui, QtCore




# this is a threaded video stream
cam = Camera(camnum=0, width= 400).start()
print "Starting webcam"

class UI(QFrame):
    def __init__(self):
        super(UI, self).__init__()

        self.initUI()

    def initUI(self):
        grid = QtGui.QGridLayout()
        grid.setSpacing(5)

        title = QtGui.QLabel('Set Alarm')
        titleEdit = QtGui.QLineEdit()
        author = QtGui.QLabel('Train model')
        authorEdit = QtGui.QLineEdit()

        grid.addWidget(title, 1, 0)
        grid.addWidget(titleEdit, 1, 1)

        grid.addWidget(author, 2, 0)
        grid.addWidget(authorEdit, 2, 1)

        btnChooseFile = Sound.BtnChooseFile()
        grid.addWidget(btnChooseFile, 3, 0)
        camScreen = CamScreen()
        grid.addWidget(camScreen, 3, 1, 5, 1)

        self.setLayout(grid)

        self.setGeometry(200, 200, 600, 400)
        self.setWindowTitle('Review')
        self.show()


class CamScreen(QWidget):
    Speed = 30

    def __init__(self):

        super(CamScreen, self).__init__()
        self.setWindowTitle("CamScreen")
        self.setGeometry(300, 300, 400, 300)

        #getting the first frame
        self.frame = cam.read()

        btn1 = QPushButton("Click me", self)
        btn1.move(40, 20)
        btn1.clicked.connect(self.btn1_clicked)

        self.timer = QBasicTimer()
        self.timer.start(CamScreen.Speed, self)

    def btn1_clicked(self):
        self.frame = cam.read()
        self.update()
        QMessageBox.about(self, "message", "clicked")

        print self.frame

    def paintEvent(self, QPaintEvent):
        # this is called first when the class is initiated
        # and called whenever self.update() is called.
        # the camera is updated using this.

        painter = QPainter()
        painter.begin(self)
        height, width, byteValue = self.frame.shape
        byteValue = byteValue * width

        self.mQImage = QImage(self.frame, width, height, byteValue, QImage.Format_RGB888)

        painter.drawImage(0, 0, self.mQImage)
        painter.end()

    def timerEvent(self, event):

        if event.timerId() == self.timer.timerId():
            self.frame = cam.read()
            self.update()

        else:
            super(CamScreen, self).timerEvent(event)



if __name__ == "__main__":
    app = QApplication(sys.argv)
    myWindow = UI()
    myWindow.show()
    app.exec_()
    cam.stop()